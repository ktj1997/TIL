# 사용자 수에 따른 규모 확장성
확장성 있는 구조를 갖기위해 고려해봐야 할 기술들 

## Scale Up(수직적 규모 확장) vs Scale Out(수평적 규모 확장)

### Scale Up
**단일 서버에 고사양 자원을 추가하는 과정**
- 장점
  - 트래픽이 적지만, 작업의 처리과정에 많은 사양이 필요할 경우 적합
  - 단순함
- 단점
  - 하드웨어의 성능에는 한계치가 있음
  - 자동복구(FailOver)나 다중화 방안이 없음 

- 하드웨어 사양의 최대치에는 한계가있음

### Scale Out
**더 많은 서버를 추가하는 방법**
- 장점
  - FailOver나 다중화 가능
  - 대규모 어플리케이션에 적합(트래픽 분산) 

## LoadBalancer (로드벨런서)
**부하분산 집합에 속한 웹서버들에게 트래픽을 고르게 분배하는 역할**

- 모든 웹서버 앞에 위치한다.
- 웹서버는 클라이언트의 접속을 직접처리하지 않는다.
- 보안을 위해 Private IP를 이용해서 통신한다.
- FailOver가 해소되며 가용성이 향상된다.

## 데이터베이스 다중화
원본을 Master서버에, 복사본을 Slave서버에 저장시키는 것

- Write연산은 Master서버에서만 가능
- Read연산은 Slave서버에서 처리
- 1 (Master) : N (Slave) 형태로 주로 구성된다.
- 여러 연산을 나누어서 처리 하기 때문에 성능이 향상된다.
- 여러개의 DB가 존재하기 때문에, FailOver나 가용성이 향상된다.

만약 1 (Master) : 1 (Slave) 상황에서 Slave가 죽는다면?
- Master가 읽기연산까지 대체할 것 이다.

만약 1 (Master) : N (Slave) 상황에서 Slave가 죽는다면?
- 다른 Slave가 존재하기 떄문에 서비스에는 문제가 없다. (가용성)
- 새로운 Slave 데이터베이스가 시작되고, 장애가 있는 Slav 데이터베이스를 대체 할 것이다. (FailOver)

만약 Master가 죽는다면?
- 다중 마스터 (Multi-Master)
- 원형 다중화 (Circular-Replication)

### 샤딩 (Sharding)
데이터베이스 다중화 (수평적 확장)<br>
모든 다중화 데이터베이스는 같은 스키마를 가지지만, 각각의 샤드에 있는 데이터는 다르다.

장점 
- 데이터가 분산되어있기 때문에, 빠르게 접근 가능하다.

단점 
- 시스템이 복잡해진다.
- 샤드 재배치 문제가 바랭한다.
- Join, 비정규화의 문제

## Cache (캐시)
**값 비싼 연산결과 또는 자주 참조되는 데이터를 메모리에 저장해 두고, 보다 빨리 응답하기 위해 고안된 저장소**

- 데이터베이스에 접근하는 것 보다 훨씬 성능이 좋다
- 데이터베이스의 부하를 분산 시킬 수 있다.
- 다양한 캐시 전략이 있다.
  - https://wnsgml972.github.io/database/2020/12/13/Caching/


캐시 적용시 유의 해야할 점
  - 데이터 갱신이 많이 발생 하지 않는 데이터인가?
  - 캐시 만료시점
  - 일관성 유지 전략
  - 장애에 대한 대처
    - 단일 캐시는 SPOF(SinglePointOfFailure)이 될 수도 있다. 
  - 방출(Eviction) 대책
  - 캐시 메모리를 얼마나 잡을 것 인가

## CDN (ContentDeliveryNetwork)
**정적 컨텐츠를 전송하는데 사용되는 지리적으로 분산된 네트워크 서버**<br>
사용자가 요청을 보내면 지리적으로 가까운 CDN서버가 정적 컨텐츠를 사용자에게 제공한다.

### 동작과정
1. 사용자의 요청을 가까운 CDN서버가 받는다.
2. CDN서버에 해당 요청에 맞는 응답이 없다면, 원본서버에 요청을보낸다.
3. 원본서버의 응답을 CDN서버는 캐싱 하고, 사용자에게 응답한다.

- 자주사용되지 않는 정적컨텐츠를 캐싱하는 것은 효율이 좋지 않으므로, CDN에 두는 것을 고려해볼만 하다.
- 주로 ThirdPartyProvider를 통해서 제공되고, 전송량에 따라서 금액이 부과된다.
- 적절한 ExpireTime을 정의해야 자주 원본서버에 접근하거나, 데이터의 일관성을 유지 할 수 있다.
- 장애대응 방법을 강구해야한다.

##  Data Center(데이터센터)
사용자의 요청을 지리적을 가까운 데이터센터로 라우팅 (Geo-Routing)<br>
CDN과 마찬가지로, 지리적으로 가까운 데이터센터에 요청을 보내기 때문에 빠른 응답속도를 가진다.<br><br>


유의해야 할점
- 트래픽 우회 : 적합한 데이터센터로 라우팅 시킬 수 있어야한다.
- 데이터 동기화: 각 데이터센터 마다 다른 데이터베이스를 사용한다면 데이터가 일관성이 있어야하며, 모두 최신 데이터여야 한다.
- 테스트&배포: 여러 위치에서 테스트를 모두 해보고, 동일한 환경의 배포가 보장되는 것이 중요하다.

## Message Queue (메세지 큐)
**무손실, 비동기 통신을 지원하는 컴포넌트**<br>
producer -> MQ -> Consumer의 구조를 가진다.

- 서비스간의 결합이 느슨해진다.
- 안정적인 서비스가 가능해진다. (Producer가 죽더라도 Consumer는 Consume가능 & 역도 성립)
- 비동기 작업을 지원하기 떄문에 빠른 응답속도를 보인다.




