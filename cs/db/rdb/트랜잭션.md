# 트랜잭션
- **DB에서 신뢰성을 보장하기위한 작업의 작은 단위**
  - 같은 Connection, Session에서 여러가지의 쿼리가 실행된다.
  - 모두 성공하여 반영되거나 실패하여 롤백된다. 
- RedoLog(변경 내용 재반영), UndoLog(롤백)을 이용해 사용한다.


***
## ACID

### Atomic(원자성)
- 한 작업의 결과로 모두 반영되거나 반영되지 않아야하는 특성
- ex) 계좌이체 중간에 오류가 발생하면, 돈이 줄어들면 안된다. 오류가없다면 액수만큼 돈이 줄어들어야한다.
### Consistency (일관성)
- 작업처리의 결과가 항상 일관성이 있어야 한다는 특성 
- ex) 계좌이체 진행 후의 돈 + 송금한 돈 = 계좌이체 진행 전의 돈
### Isolation (독립성)
- 한 트랜잭션이 다른 트랜잭션에 영향을 끼칠 수 없는 특성
- 수행중인 트랜잭션이 완료되기 전까지, 다른 트랜잭션의 수행결과를 참조 할 수 없다.

### Durability (지속성)
- 트랜잭션이 성공적으로 완료 되었을 때, 영구적으로 지속되어야 하는 특성
- 지속성을 유지하기위해서는 원래상태로 복구되는 회복기능이 필요(고가용성)

***
## 트랜잭션 연산

### 1. Commit
- 트랜잭션 연산이 성공적으로 수행 된 것
- Commit연산이 실행 된후 트랜잭션 결과는 일관된 상태를 지속
- Commit연산이 수행되면 데이터베이스에 반영

### 2. Rollback
- 트랜잭션의 작업이 실패 한 것
- Rollback연산 실행 시, 트랜잭션 이전상태로 되돌아감
- Rollback연산 실행 시, 트랜잭션 이전 상태의 일관된 상태로 지속되어야함

***
## 트랜잭션 격리수준

### 1. READ UNCOMMITTED
- Commit,Rollback 여부와 상관없이 다른 트랜잭션의 변경내용이 보여진다.
- 데이터 정합성에 문제가 발생한다.
- DirtyRead 발생 가능성이 있다.
  - A트랜잭션의 중간과정에서 B트랜잭션이 결과참조 -> <br>A트랜잭션이 롤백 -> <br>B트랜잭션은 롤백 여부와 상관없이 A를 참조한 시점의 결과값으로 연산을 진행 

### 2. READ COMMITTED
- 트랜잭션 내용이 변경되고 Commit되어야만, 다른 트랜잭션에서 참조가 가능하다.
- 많은 DBMS에서 가장많이 사용하는 격리수준
- NonRepetableRead 발생 가능성이 있다. (한 트랜잭션 내에서 똑같은 요청에 다른결과)
  - B트랜잭션 (SELECT 2번)이 A에 관한 1번쨰 SELECT를 진행 -><br>
  - A가 트랜잭션에 의해서 변경 -> <br>
  - B가 2번째 SELECT를 진행 (변경된 A가 조회됨)

### 3. REPEATABLE READ
- InnoDB Default 트랜잭션 레벨
- MVCC (다중 버전 제어)가 사용된다.
  - 트랜잭션 시작 전 Rollback 가능성을 염두하여, 트랜잭션 시작 시점의 SnapShot을 찍어두고 Undo로그에 저장.
  - UndoLog를 통해서 일관성있는 데이터를 제공한다.
  - 필요한 시점까지 UndoLog를 유지한다. (트랜잭션이 오래 유지될 경우 성능에 악영향 --> UndoLog에 계속 쌓일 테니까)
- Update 부정합 발생 가능성이 있다.
  - 트랜잭션 A의 UPDATE 연산 도중 다른 트랜잭션 B가 업데이트를 먼저 수행 -> A의 트랜잭션 반영 (x)
- Phantom Read 발생 가능성이 있다.
  - 범위 모두를 보관하지 못하기 떄문에 발생한다.
    - GapLock을 통해 해결이 가능하다.
  - 첫 번째 쿼리에서 보이지 않았던 결과가 두 번쨰 쿼리에 나타나는 경우 (역도 성립)
  - 2번의 SELECT 도중, 그 사이에 데이터가 INSERT 되거나, DELETE 되었을 때 발생
### 4. SERIALIZABLE 
- 두 개의 트랜잭션이 동시에 수행되지 않음
- 읽기 작업에도 LOCK
- 동시성이 떨어지고 성능저하 발생
- table 수준의 LOCK 이다.
